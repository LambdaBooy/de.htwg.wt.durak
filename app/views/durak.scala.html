@import de.htwg.se.durak.util.cardConverter._
@import de.htwg.se.durak.model.cardComponent.CardInterface
@(controller: de.htwg.se.durak.controller.controllerComponent.ControllerInterface)

@counter = @{
    0
}

@numberOfPlayers = @{
    controller.players.size
}

@gameStatus = @{
    controller.gameStatus
}

@deckSize = @{
    controller.deckSizeToString
}

@activePlayer = @{
    controller.activePlayerToString
}

@trumpCard = @{
    val trumpCardAsString = controller.trumpCardToString
    val trumpCardArray: Array[String] = trumpCardAsString.split(",")
    var trumpCard: Array[CardInterface] = Array.empty

    CardStringConverter.parseCardStringToCardObject(trumpCardAsString)
}

@attacker = @{
    controller.currentAttackerToString
}

@defender = @{
    controller.currentVictimToString
}

@neighbor = @{
    controller.currentNeighbourToString
}

@attackCards = @{
    val attackCardsAsString = controller.currentAttackCardsToString
    val attackCardsArray: Array[String] = attackCardsAsString.split(",")
    var attackCards: Array[CardInterface] = Array.empty

    attackCardsArray.foreach(cardString => {
        if(!(cardString == "")) {
            val card = CardStringConverter.parseCardStringToCardObject(cardString.trim)
            attackCards = attackCards :+ card
        }
    })

    attackCards
}

@blockCards = @{
    var blockCards: Array[CardInterface] = Array.empty

    for((blockCard, blockingCard) <- controller.getCurrentBlockedByMap) {
        blockCards = blockCards :+ blockCard
    }

    blockCards
}

@blockingCards = @{
    var blockingCards: Array[CardInterface] = Array.empty

    for((blockCard, blockingCard) <- controller.getCurrentBlockedByMap) {
        blockingCards = blockingCards :+ blockingCard
    }

    blockingCards

}

@handCards = @{
    val handCardsAsString = controller.activePlayerHandCardsToString
    val handCardsArray: Array[String] = handCardsAsString.split(",")
    var handCards: Array[CardInterface] = Array.empty

    handCardsArray.foreach(cardString => {
        if(!(cardString == "")) {
            val card = CardStringConverter.parseCardStringToCardObject(cardString)
            handCards = handCards :+ card
        }
    })

    handCards
}

@winners = @{
    controller.winnersToString
}


@main("HTWG Durak") {

    <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/durak.css")' />
    <div id="gameContainer" class="container-fluid">

        <div class="row">
            <div class="col"></div>
            <div class="col">
                <p id="deckInfo"><b>Cards in Deck: @deckSize</b></p>
            </div>
            <div class="col">
                <p id="trumpCardLabel"><b>Trump Card:</b></p>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div id="gameInfo">
                    <p><b>Active: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@activePlayer</b></p>
                    <p><b>Attacker: &nbsp;&nbsp;&nbsp;@attacker</b></p>
                    <p><b>Victim: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@defender</b></p>
                    <p><b>Neighbor: &nbsp;&nbsp;@neighbor</b></p>

                </div>
            </div>
            <div class="col"></div>
            <div class="col" id="trumpCardBox">
                <img class="cardImg" src=@{
                    routes.Assets.versioned("images/" + CardImgConverter.getCardColorPath(trumpCard)
                            + CardImgConverter.getCardValuePath(trumpCard))
                } />
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div id="attackCards" ondrop="handleHandCardsOnDrop(event)"  ondragover="enableDrop(event)" class="scrollmenu" >
                    @for(card <- attackCards) {
                        <img class="cardImg" src=@{
                            routes.Assets.versioned("images/" + CardImgConverter.getCardColorPath(card)
                                    + CardImgConverter.getCardValuePath(card))
                        } />
                    }
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="scrollmenu" id="defendedCardsContainer">
                    <div>

                        <div id="blockedCards">
                        @for(card <- blockCards) {
                            <img class="cardImg" src=@{routes.Assets.versioned("images/" + CardImgConverter.getCardColorPath(card)
                                        + CardImgConverter.getCardValuePath(card))} />
                            }
                        </div>

                        <div id="blockingCards">
                        @for(card <- blockingCards) {
                            <img class="cardImg" src=@{
                                routes.Assets.versioned("images/" + CardImgConverter.getCardColorPath(card)
                                        + CardImgConverter.getCardValuePath(card))
                            } />
                        }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" id="handCardsView">
            <div class="col-md-auto">
                <div id="leftButtonsContainer">
                    <div>
                        <a href="http://localhost:9000/ok">
                            <button id="okayButton" class="btn btn-dark" type="button">
                                <b>OKAY</b>
                                <img id="thumpUpImg" src=@routes.Assets.versioned("images/thump_up.png")>
                            </button>
                        </a>
                    </div>
                    <div>
                        <a href="http://localhost:9000/take">
                            <button id="takeButton" class="btn btn-dark">
                                <b>TAKE</b>
                                <img id="poopImg" src=@routes.Assets.versioned("images/poop.png")>
                            </button>
                        </a>
                    </div>
                    <div>
                        <a href="http://localhost:9000/undo">
                            <button id="undoButton" class="btn btn-dark" type="button">
                                <b>UNDO</b>
                                <img id="undoArrowImg" src=@routes.Assets.versioned("images/undo_arrow.png")>
                            </button>
                        </a>
                    </div>
                </div>
            </div>
            <div ondrop="handleHandCardsOnDrop(event)"  ondragover="enableDrop(event)" class="col-md-5" id="handView">
                <div class="scrollmenu">
                @for((card, i) <- handCards.zipWithIndex) {
                    <img id=@("handCard" + i) draggable="true" ondragstart="handCardDragHandler(event)" class="cardImg" src=@{
                        routes.Assets.versioned("images/" + CardImgConverter.getCardColorPath(card)
                                + CardImgConverter.getCardValuePath(card))
                    } />
                }
                </div>
            </div>
        </div>
    </div>
}
